<?xml version="1.0"?>

<!-- Configuration for EvaporationTest.h, a configurable evaporation flow test for noise-filtered multi-instance Nie coupling -->
<evaporation-test>
  <!-- Coupled simulation general setup parameters:
    - int coupling-cycles:
      Total number of coupling cycles to run. Each cycle may consist of e.g. 100 MD timesteps.
    - int write-csv-every-timestep:
      Writes data collected by sendFromMD2Macro, i.e. noise filter output, to CSV file; for evaluation.
      timestep means coupling cycle here.
  -->
  <coupling
    coupling-cycles="50000"
    write-csv-every-timestep="0"
  />

  <!-- Configuration parameters for macroscopic solver:
    - Vector<3,unsigned int> number-of-processes:
      Number of LB ranks per direction (x; y; z)
    - int plot-every-timestep:
      VTK plotting per time step, only for LB solver
    - foam: string foam-setup-directory:
      path to the OpenFOAM setup directory
    - foam: string foam-setup-folder:
      name of the OpenFOAM folder
  -->
  <macroscopic-solver
    number-of-processes="1 ; 1 ; 1"
    plot-every-timestep="2"
    foam-setup-directory="/home/helene/Dokumente/mamico-dev/coupling/tests/build_couette"
    foam-setup-folder="FoamSetup"
  />

  <!-- Configuration parameters for microscopic solver:
    - string type:
      Supports "md" (SimpleMD) 
    - md: double temperature:
      Temperature of MD system, is initially applied to the molecules using the thermostat.
    - md: int number-md-simulations:
      Total number of MD instances.
      Set to 1 to disable multi-instance sampling.
  -->
  <microscopic-solver
    type="md"
    temperature="0.8"
    number-md-simulations="1"
  />

</evaporation-test>
<!-- MaMiCo configuration for NieTest, as described in the respective paper -->
<mamico>
  <!-- "write-every-macroscopic-timestep" means CFD time step /-->
  <macroscopic-cell-configuration
    cell-size="200 ; 200 ; 2.5"
    linked-cells-per-macroscopic-cell="80 ; 80 ; 1"
    write-every-microscopic-timestep="0"
    microscopic-filename="MacroscopicCell_micro"
    write-every-macroscopic-timestep="0"
    macroscopic-filename="MacroscopicCell_macro"
  />
  <!-- particle-insertion type="usher" enables removal of particles  /-->
  <!-- TODO choose insert-every-timestep automatically /-->
  <!-- TODO check tolerance criterium /-->
  <particle-insertion type="usher" maximum-number-of-iterations="100" maximum-number-of-restarts="500" insert-every-timestep="1000" tolerance="0.5" />
  <!--<particle-insertion type="none" />/-->
  <momentum-insertion type="none" outermost-overlap-layer="2" innermost-overlap-layer="3" />
  <!-- TODO inconsistent mass flux evaluation? /-->
  <transfer-strategy type="nie-transfer" mass-flux-west="no" mass-flux-east="no" mass-flux-north="no" mass-flux-south="no" mass-flux-bottom="no" mass-flux-top="no" shift-by-timesteps="0.5"/>
  <!-- time-window-size means number of coupling cycles/-->
  <!-- TODO try to use local density for boundary force /-->
  <boundary-force type="zhou-boundary-force" west="no" east="no" north="no" south="no" bottom="yes" top="no" density="0.73" temperature="0.8" />
  <parallel-topology type="xyz" />
  <!-- the thermostat option defines, where to apply the above defined temperature within the md region, options:
    -all: the thermostat will be applied in every cell of the md region
    -outerLayers: the thermostat will be applied in the value defined in "number-layers" (integer value) number of layers, starting with the most outer layer
    -onlyOutestLayer: the thermostat will be applied only in the outest cell layer of the md region
    -nowhere: the thermostat will be applied nowehere within the md region /-->
  <thermostat type='nowhere' number-layers='1' />
</mamico>

<molecular-dynamics>

  <!-- initial temperature should be 1.27 to reach 1.1 after equilibration /-->
  <molecule-configuration
    mass="1.0"
    temperature="1.27"
    sigma="1.0"
    epsilon="1.0"
    mean-velocity="0.0 ; 0.0 ; 0.0"
  ></molecule-configuration>

  <!-- number of linked cells must be divisible by number-of-processes /-->
  <!-- number of mpi ranks must be total number-of-processes /-->
  <mpi-configuration number-of-processes="1 ; 1 ; 1" ></mpi-configuration>

  <!-- TODO check fix-seed for mamico / USHER /-->
  <simulation-configuration
    dt="0.001824"
    number-of-timesteps="50"
    reorganise-memory-every-timestep="20"
    buffer-size-factor = "0"
    compute-macroscopic-quantities-every-timestep="0"
    fix-seed="no"
   ></simulation-configuration>

  <vtk-configuration filename="Molecules" write-every-timestep="20"></vtk-configuration>

  <checkpoint-configuration filename="CheckpointSimpleMD_Eva_run" write-every-timestep="0"></checkpoint-configuration>

  <!-- max density using molecules-per-direction ca. 0.9  /-->
  <!-- cutoff-radius should be 2.2 to be consistent with Nie et. al paper /-->
  <domain-configuration
    init-from-sequential-checkpoint="CheckpointSimpleMD_Eva"

    molecules-per-direction="28 ; 28 ; 28"
    domain-size="200 ; 200 ; 422.5"
    domain-offset="0 ; 0 ; 0"
    cutoff-radius="2.5"
    linked-cell-size="2.5 ; 2.5 ; 2.5"
    k_B="1.0"
    block-size="100"

    bottom-south-west="reflecting" bottom-south="reflecting" bottom-south-east="reflecting"
    bottom-west="reflecting"       bottom="reflecting"       bottom-east="reflecting"
    bottom-north-west="reflecting" bottom-north="reflecting" bottom-north-east="reflecting"

    south-west="periodic"        south="periodic"        south-east="periodic"
    west="periodic"                                          east="periodic"
    north-west="periodic"        north="periodic"        north-east="periodic"

    top-south-west="reflecting"    top-south="reflecting"    top-south-east="reflecting"
    top-west="reflecting"          top="reflecting"          top-east="reflecting"
    top-north-west="reflecting"    top-north="reflecting"    top-north-east="reflecting"
  > </domain-configuration>

</molecular-dynamics>

<filter-pipeline>

	<per-instance output="md">
    </per-instance>

	<post-multi-instance output="md">
    </post-multi-instance>

</filter-pipeline>
